{"version":3,"file":"mobx-initializer.cjs.development.js","sources":["../src/util.ts","../src/index.ts"],"sourcesContent":["export const applyHandler = (target, handlersName, ...args) => {\n  const handlersPropertyName = \"_\" + handlersName + \"Handler\";\n  for (\n    let current = target;\n    current;\n    current = Object.getPrototypeOf(current)\n  ) {\n    if (current.hasOwnProperty(handlersPropertyName)) {\n      for (const handler of current[handlersPropertyName] || []) {\n        handler.apply(target, args);\n      }\n    }\n  }\n};\n\nexport const applyHandlerOnce = (target, handlersName, ...args) => {\n  const handlersPropertyName = \"_\" + handlersName + \"Handler\";\n  const flagPropetyName = handlersPropertyName + \"Done\";\n  if (target[flagPropetyName]) {\n    return;\n  }\n  target[flagPropetyName] = true;\n  applyHandler(target, handlersName, ...args);\n};\n\nexport const addHandler = (target, handlersName, handler) => {\n  const handlersPropertyName = \"_\" + handlersName + \"Handler\";\n  if (!target.hasOwnProperty(handlersPropertyName)) {\n    target[handlersPropertyName] = [];\n  }\n  target[handlersPropertyName].push(handler);\n};\n\nconst _combineDecorator = (...decorators) => {\n  return (_target, fieldName, _descriptor) => {\n    if (fieldName) {\n      if (typeof fieldName !== \"string\") {\n        console.error(_target, fieldName, _descriptor, decorators);\n        debugger;\n      }\n      const target = _target;\n      let descriptor = _descriptor;\n      for (const decorator of decorators) {\n        descriptor = decorator(target, fieldName, descriptor) || descriptor;\n      }\n      return descriptor === _descriptor ? null : descriptor;\n    } else {\n      let target = _target;\n      for (const decorator of decorators) {\n        target = decorator(target) || target;\n      }\n      return target === _target ? null : target;\n    }\n  };\n};\n\nexport const combineDecorator = (...decorators) => {\n  return (target, ...args) => {\n    if (\n      target.hasOwnProperty(\"constructor\") ||\n      target.hasOwnProperty(\"prototype\")\n    ) {\n      const [ fieldName, descriptor] = args;\n      return _combineDecorator(\n        ...decorators.map(decorator =>\n          decorator[isAcceptable] ? decorator.decorator : decorator\n        )\n      )(target, fieldName, descriptor);\n    } else {\n      return _combineDecorator(\n        ...decorators.map(decorator =>\n          decorator[isAcceptable]\n            ? decorator.decorator(target, ...args)\n            : decorator\n        )\n      );\n    }\n  };\n};\n\nexport const parametrizeDecorator = (decorator, defaultValue) => {\n  return (target, ...args) => {\n    if (\n      target.hasOwnProperty(\"constructor\") ||\n      target.hasOwnProperty(\"prototype\")\n    ) {\n      // パラメータがない時\n      return decorator(defaultValue(target, ...args))(target, ...args);\n    } else {\n      // パラメータが与えられた時\n      return decorator(target, ...args);\n    }\n  };\n};\n\nconst isAcceptable = Symbol(\"isAcceptable\");\n\nexport const acceptParams = decorator => ({\n  decorator,\n  [isAcceptable]: true,\n});\n","import { applyHandlerOnce } from \"./util\";\nexport * from \"./util\";\n\nconst appliedFlag = Symbol(\"isAppliedMobxInitializer\");\n\nexport const initializer = (target, ...args) => {\n  if (target.prototype[appliedFlag]) {\n    return target;\n  }\n  return class initializer extends target {\n    [appliedFlag] = true;\n    constructor(props) {\n      super(props);\n      applyHandlerOnce(this, \"init\", props);\n    }\n  };\n};\n\n"],"names":["applyHandler","target","handlersName","handlersPropertyName","args","current","Object","getPrototypeOf","hasOwnProperty","handler","apply","applyHandlerOnce","flagPropetyName","addHandler","push","_combineDecorator","decorators","_target","fieldName","_descriptor","console","error","descriptor","decorator","combineDecorator","map","isAcceptable","parametrizeDecorator","defaultValue","Symbol","acceptParams","appliedFlag","initializer","prototype","props"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAAaA,YAAY,GAAG,SAAfA,YAAe,CAACC,MAAD,EAASC,YAAT;AAC1B,MAAMC,oBAAoB,GAAG,MAAMD,YAAN,GAAqB,SAAlD;;oCADoDE;AAAAA,IAAAA;;;AAEpD,OACE,IAAIC,OAAO,GAAGJ,MADhB,EAEEI,OAFF,EAGEA,OAAO,GAAGC,MAAM,CAACC,cAAP,CAAsBF,OAAtB,CAHZ,EAIE;AACA,QAAIA,OAAO,CAACG,cAAR,CAAuBL,oBAAvB,CAAJ,EAAkD;AAChD,2DAAsBE,OAAO,CAACF,oBAAD,CAAP,IAAiC,EAAvD,wCAA2D;AAAA,YAAhDM,OAAgD;AACzDA,QAAAA,OAAO,CAACC,KAAR,CAAcT,MAAd,EAAsBG,IAAtB;AACD;AACF;AACF;AACF;IAEYO,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACV,MAAD,EAASC,YAAT;AAC9B,MAAMC,oBAAoB,GAAG,MAAMD,YAAN,GAAqB,SAAlD;AACA,MAAMU,eAAe,GAAGT,oBAAoB,GAAG,MAA/C;;AACA,MAAIF,MAAM,CAACW,eAAD,CAAV,EAA6B;AAC3B;AACD;;AACDX,EAAAA,MAAM,CAACW,eAAD,CAAN,GAA0B,IAA1B;;qCANwDR;AAAAA,IAAAA;;;AAOxDJ,EAAAA,YAAY,MAAZ,UAAaC,MAAb,EAAqBC,YAArB,SAAsCE,IAAtC;AACD;IAEYS,UAAU,GAAG,SAAbA,UAAa,CAACZ,MAAD,EAASC,YAAT,EAAuBO,OAAvB;AACxB,MAAMN,oBAAoB,GAAG,MAAMD,YAAN,GAAqB,SAAlD;;AACA,MAAI,CAACD,MAAM,CAACO,cAAP,CAAsBL,oBAAtB,CAAL,EAAkD;AAChDF,IAAAA,MAAM,CAACE,oBAAD,CAAN,GAA+B,EAA/B;AACD;;AACDF,EAAAA,MAAM,CAACE,oBAAD,CAAN,CAA6BW,IAA7B,CAAkCL,OAAlC;AACD;;AAED,IAAMM,iBAAiB,GAAG,SAApBA,iBAAoB;qCAAIC;AAAAA,IAAAA;;;AAC5B,SAAO,UAACC,OAAD,EAAUC,SAAV,EAAqBC,WAArB;AACL,QAAID,SAAJ,EAAe;AACb,UAAI,OAAOA,SAAP,KAAqB,QAAzB,EAAmC;AACjCE,QAAAA,OAAO,CAACC,KAAR,CAAcJ,OAAd,EAAuBC,SAAvB,EAAkCC,WAAlC,EAA+CH,UAA/C;AACA;AACD;;AACD,UAAMf,MAAM,GAAGgB,OAAf;AACA,UAAIK,UAAU,GAAGH,WAAjB;;AACA,4DAAwBH,UAAxB,2CAAoC;AAAA,YAAzBO,SAAyB;AAClCD,QAAAA,UAAU,GAAGC,SAAS,CAACtB,MAAD,EAASiB,SAAT,EAAoBI,UAApB,CAAT,IAA4CA,UAAzD;AACD;;AACD,aAAOA,UAAU,KAAKH,WAAf,GAA6B,IAA7B,GAAoCG,UAA3C;AACD,KAXD,MAWO;AACL,UAAIrB,QAAM,GAAGgB,OAAb;;AACA,4DAAwBD,UAAxB,2CAAoC;AAAA,YAAzBO,UAAyB;AAClCtB,QAAAA,QAAM,GAAGsB,UAAS,CAACtB,QAAD,CAAT,IAAqBA,QAA9B;AACD;;AACD,aAAOA,QAAM,KAAKgB,OAAX,GAAqB,IAArB,GAA4BhB,QAAnC;AACD;AACF,GAnBD;AAoBD,CArBD;;IAuBauB,gBAAgB,GAAG,SAAnBA,gBAAmB;qCAAIR;AAAAA,IAAAA;;;AAClC,SAAO,UAACf,MAAD;uCAAYG;AAAAA,MAAAA;;;AACjB,QACEH,MAAM,CAACO,cAAP,CAAsB,aAAtB,KACAP,MAAM,CAACO,cAAP,CAAsB,WAAtB,CAFF,EAGE;AAAA,UACQU,SADR,GACiCd,IADjC;AAAA,UACmBkB,UADnB,GACiClB,IADjC;AAEA,aAAOW,iBAAiB,MAAjB,SACFC,UAAU,CAACS,GAAX,CAAe,UAAAF,SAAS;AAAA,eACzBA,SAAS,CAACG,YAAD,CAAT,GAA0BH,SAAS,CAACA,SAApC,GAAgDA,SADvB;AAAA,OAAxB,CADE,EAILtB,MAJK,EAIGiB,SAJH,EAIcI,UAJd,CAAP;AAKD,KAVD,MAUO;AACL,aAAOP,iBAAiB,MAAjB,SACFC,UAAU,CAACS,GAAX,CAAe,UAAAF,SAAS;AAAA,eACzBA,SAAS,CAACG,YAAD,CAAT,GACIH,SAAS,CAACA,SAAV,OAAAA,SAAS,GAAWtB,MAAX,SAAsBG,IAAtB,EADb,GAEImB,SAHqB;AAAA,OAAxB,CADE,CAAP;AAOD;AACF,GApBD;AAqBD;IAEYI,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACJ,SAAD,EAAYK,YAAZ;AAClC,SAAO,UAAC3B,MAAD;uCAAYG;AAAAA,MAAAA;;;AACjB,QACEH,MAAM,CAACO,cAAP,CAAsB,aAAtB,KACAP,MAAM,CAACO,cAAP,CAAsB,WAAtB,CAFF,EAGE;AACA;AACA,aAAOe,SAAS,CAACK,YAAY,MAAZ,UAAa3B,MAAb,SAAwBG,IAAxB,EAAD,CAAT,gBAAyCH,MAAzC,SAAoDG,IAApD,EAAP;AACD,KAND,MAMO;AACL;AACA,aAAOmB,SAAS,MAAT,UAAUtB,MAAV,SAAqBG,IAArB,EAAP;AACD;AACF,GAXD;AAYD;AAED,IAAMsB,YAAY,gBAAGG,MAAM,CAAC,cAAD,CAA3B;IAEaC,YAAY,GAAG,SAAfA,YAAe,CAAAP,SAAS;AAAA;;AAAA;AACnCA,IAAAA,SAAS,EAATA;AADmC,UAElCG,YAFkC,IAEnB,IAFmB;AAAA;;AC9FrC,IAAMK,WAAW,gBAAGF,MAAM,CAAC,0BAAD,CAA1B;AAEA,IAAaG,WAAW,GAAG,SAAdA,WAAc,CAAC/B,MAAD;;;AACzB,MAAIA,MAAM,CAACgC,SAAP,CAAiBF,WAAjB,CAAJ,EAAmC;AACjC,WAAO9B,MAAP;AACD;;AACD;;;AAEE,yBAAYiC,KAAZ;;;AACE,iCAAMA,KAAN;AAFF,cAAA,IAAgB,IAAhB;AAGEvB,MAAAA,gBAAgB,gCAAO,MAAP,EAAeuB,KAAf,CAAhB;;AACD;;;IAL8BjC,cAC9B8B,eADH;AAOD,CAXM;;;;;;;;;;"}