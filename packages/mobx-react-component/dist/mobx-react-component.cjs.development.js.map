{"version":3,"file":"mobx-react-component.cjs.development.js","sources":["../src/component.ts","../src/intercept.ts","../src/prop.ts","../src/state.ts","../src/render.ts","../src/resource.ts","../src/watch.ts"],"sourcesContent":["import { observable } from \"mobx\";\nimport {\n  applyHandler,\n  ClassType,\n  combineClassDecorator,\n} from \"mobx-initializer\";\nimport React from \"react\";\nconst componentAppliedFlag = Symbol(\"isAppliedMobxReactComponentInitializer\");\nconst pureComponentAppliedFlag = Symbol(\n  \"isAppliedMobxReactPureComponentInitializer\"\n);\n\nexport const componentStatus = Symbol(\"componentStatus\");\n\nexport type ReactComponentType = ClassType<React.Component>;\n\nconst _component = (target: ReactComponentType): ReactComponentType => {\n  if (target.prototype[componentAppliedFlag]) {\n    return target;\n  }\n  class Component extends target {\n    [componentAppliedFlag] = true;\n    [componentStatus]?: string;\n    @observable.ref\n    props: any;\n    constructor(props: any) {\n      super(props);\n      applyHandler(this, \"init\", props);\n      applyHandler(this, \"stateRegister\", props);\n      applyHandler(this, \"resourceRegister\", props);\n    }\n    componentDidMount() {\n      super.componentDidMount?.call(this);\n      this[componentStatus] = \"mounted\";\n    }\n    componentWillUnmount() {\n      super.componentWillUnmount?.call(this);\n      applyHandler(this, \"release\");\n    }\n  }\n  return Component;\n};\n\n// pure componentでは、propの変更があってもstateの変更がない限り、renderされない\n\nconst _pureComponent = (target: any) => {\n  if (target.prototype[pureComponentAppliedFlag]) {\n    return target;\n  }\n  return class Component extends target {\n    [pureComponentAppliedFlag] = true;\n    shouldComponentUpdate(nextProps: any, nextState: any) {\n      return nextState !== this.state;\n    }\n  };\n};\n\nexport const component = _component as ClassDecorator & {\n  pure: ClassDecorator;\n};\n\ncomponent.pure = combineClassDecorator(\n  _component,\n  _pureComponent\n) as ClassDecorator;\n","import isEqual from \"lodash.isequal\";\nimport { computed, intercept as mobxIntercept } from \"mobx\";\nimport { addHandler } from \"mobx-initializer\";\n\nexport const _intercept = (handler: Function): MethodDecorator => (\n  target: object,\n  fieldName: string | symbol,\n  descriptor: PropertyDescriptor\n) => {\n  const cancelObserveFieldname = Symbol(\n    \"cancelObserveFieldname: \" + fieldName.toString()\n  );\n  addHandler(target, \"stateRegister\", function(this: any) {\n    this[cancelObserveFieldname] = mobxIntercept(\n      this,\n      fieldName,\n      handler.bind(this)\n    );\n  });\n  addHandler(target, \"release\", function(this: any) {\n    this[cancelObserveFieldname]();\n  });\n  return descriptor;\n};\n\nexport const intercept = _intercept as ((\n  handler: Function\n) => MethodDecorator) & {\n  isEqual: MethodDecorator;\n  computed: (handler: Function) => MethodDecorator;\n};\n\nintercept.computed = (handler: Function): MethodDecorator => (\n  target: object,\n  fieldName: string | symbol,\n  descriptor: PropertyDescriptor\n) => {\n  const temporaryFieldName = Symbol(\n    \"temporaryFieldName: \" + fieldName.toString()\n  );\n  return computed(target, fieldName, {\n    get(this: any) {\n      const newValue = descriptor.get?.apply(this);\n      const oldValue = this[temporaryFieldName];\n      if (handler.call(this, { newValue, oldValue })) {\n        this[temporaryFieldName] = newValue;\n      }\n      return this[temporaryFieldName];\n    },\n  });\n};\n\nintercept.isEqual = intercept.computed(\n  ({ newValue, oldValue }: { newValue: any; oldValue: any }) =>\n    !isEqual(newValue, oldValue)\n);\n","import { computed } from \"mobx\";\nimport {\n  parametrizePropertyDecorator,\n  PropertyDecoratorOptionalGenerator,\n} from \"mobx-initializer\";\n\nimport { intercept } from \"./intercept\";\n\n// example:\n// fieldIdentifierToFunc(\"foo.bar\")({ foo: { bar: 123} }) === 123\nconst fieldIdentifierToFunc = (fieldIdentifier: string) => {\n  const exp = fieldIdentifier\n    .split(\".\")\n    .map(field => `(a=a[${JSON.stringify(field)}])`)\n    .join(\"&&\");\n  return eval(`(function(a){return ${exp};})`);\n};\n\nconst createPropDecorator = (baseDecorator: MethodDecorator) => {\n  return parametrizePropertyDecorator(\n    (propName: string) => (target, fieldName) => {\n      const getter = fieldIdentifierToFunc(propName);\n      baseDecorator(target, fieldName, {\n        get: function(this: any) {\n          return getter(this.props);\n        },\n      });\n    },\n    (_target: unknown, fieldName: string) => fieldName\n  );\n};\nexport const prop = createPropDecorator(\n  computed\n) as PropertyDecoratorOptionalGenerator<string> & {\n  deep: PropertyDecoratorOptionalGenerator<string>;\n  delegate: PropertyDecoratorOptionalGenerator<string>;\n};\n\nprop.deep = createPropDecorator(intercept.isEqual);\n\nprop.delegate = parametrizePropertyDecorator(\n  (propName: string) => (target: object, fieldName: string | symbol) => {\n    return {\n      get(this: any) {\n        return (...args: any) => {\n          this.props[propName](...args);\n        };\n      },\n    } as PropertyDescriptor;\n  },\n  (_target: unknown, fieldName: string) => fieldName\n);\n","import { computed, observable, observe } from \"mobx\";\nimport { addHandler, combinePropertyDecorator } from \"mobx-initializer\";\n\nimport { componentStatus } from \"./component\";\n\nconst _state = (target: object, fieldName: string) => {\n  const cancelObserveFieldname = Symbol(\"_observe_\" + fieldName);\n\n  addHandler(target, \"stateRegister\", function(this: any) {\n    this[cancelObserveFieldname] = observe(this, fieldName, () => {\n      if (this[componentStatus] === \"mounted\") {\n        this.setState({ [fieldName]: this[fieldName] });\n      }\n    });\n    this.state = this.state || { dammy: \"###\" };\n    this.state[fieldName] = this[fieldName];\n  });\n  addHandler(target, \"release\", function(this: any) {\n    this[cancelObserveFieldname]();\n  });\n};\n\nexport const state = _state as typeof _state & {\n  computed: MethodDecorator & {\n    struct: MethodDecorator;\n  };\n  observable: MethodDecorator;\n  deep: MethodDecorator;\n  shallow: MethodDecorator;\n  ref: MethodDecorator;\n  struct: MethodDecorator;\n};\n\nstate.computed = combinePropertyDecorator(\n  computed,\n  _state as PropertyDecorator\n) as PropertyDecorator & {\n  struct: PropertyDecorator;\n};\nstate.computed.struct = combinePropertyDecorator(\n  computed.struct,\n  _state as PropertyDecorator\n);\nstate.observable = combinePropertyDecorator(\n  observable.ref,\n  _state as PropertyDecorator\n);\nstate.deep = combinePropertyDecorator(\n  observable.deep,\n  _state as PropertyDecorator\n);\nstate.shallow = combinePropertyDecorator(\n  observable.shallow,\n  _state as PropertyDecorator\n);\nstate.ref = combinePropertyDecorator(\n  observable.ref,\n  _state as PropertyDecorator\n);\nstate.struct = combinePropertyDecorator(\n  observable.struct,\n  _state as PropertyDecorator\n);\n\nexport class X {\n  @state\n  x = 0;\n}\n","import * as crypto from \"crypto\";\n\nimport { state } from \"./state\";\n\nexport const render = (\n  target: object,\n  fieldName: string,\n  descriptor: PropertyDescriptor\n) => {\n  if (fieldName === \"render\") {\n    const fieldId = fieldName + crypto.randomBytes(8).toString(\"hex\");\n    state.computed(target, fieldId, {\n      get: descriptor.value,\n    });\n    return {\n      configurable: true,\n      value(this: any) {\n        return this[fieldId];\n      },\n    };\n  } else {\n    state.computed(target, fieldName, {\n      get: descriptor.get || descriptor.value,\n    });\n    Object.defineProperty(target, \"render\", {\n      value() {\n        return this[fieldName];\n      },\n    });\n  }\n};\n","import { computed, observable, observe } from \"mobx\";\nimport { addHandler } from \"mobx-initializer\";\n\nconst defaultHandler = (value: any) => value;\n\n// Example:\n// @resource({\n// \ton: (resource, handler) => resource.on(\"update\", handler),\n// \toff: (resource, handler) => resource.off(\"update\", handler),\n// \thandler: value => value, // or event => event.value\n// \tresourceFieldName: \"documentResource\"\n// })\n// @observable\n// document\n\nexport const resource = <Resource>({\n  on,\n  off,\n  handler = defaultHandler,\n  resourceFieldName,\n}: {\n  on: (resource: Resource, handler: Function) => void;\n  off: (resource: Resource, handler: Function) => void;\n  handler: Function;\n  resourceFieldName: string;\n}) => (target: object, fieldName: string, descriptor: PropertyDescriptor) => {\n  const wrappedHandlerFieldName = Symbol(\"_\" + fieldName + \"Handler\");\n  const cancelObserveFieldname = Symbol(\"_resource_\" + fieldName);\n\n  addHandler(target, \"init\", function(this: any) {\n    this[wrappedHandlerFieldName] = (...args: any) => {\n      this[fieldName] = handler.apply(this, args);\n    };\n    this[cancelObserveFieldname] = observe(\n      this,\n      resourceFieldName,\n      change => {\n        const { oldValue, newValue } = change;\n        if (oldValue) {\n          off(oldValue, this[wrappedHandlerFieldName]);\n        }\n        if (newValue) {\n          on(newValue, this[wrappedHandlerFieldName]);\n        }\n      },\n      true\n    );\n  });\n  addHandler(target, \"release\", function(this: any) {\n    if (this[resourceFieldName]) {\n      off(this[resourceFieldName], this[wrappedHandlerFieldName]);\n    }\n    this[cancelObserveFieldname]();\n  });\n};\n\nresource.computed = <Resource>({\n  on,\n  off,\n  handler = defaultHandler,\n}: {\n  on: (resource: Resource, handler: Function) => void;\n  off: (resource: Resource, handler: Function) => void;\n  handler: Function;\n  resourceFieldName: string;\n}) => (\n  target: object,\n  resolvedFieldName: string,\n  descriptor: PropertyDescriptor\n) => {\n  // resource\n  const resourceFieldName = resolvedFieldName + \"Resource\";\n  Object.defineProperty(target, resourceFieldName, descriptor);\n  computed(target, resourceFieldName, descriptor);\n\n  // resolved\n  delete (target as any)[resolvedFieldName];\n  return resource({ on, off, handler, resourceFieldName })(\n    target,\n    resolvedFieldName,\n    (observable.ref(target, resolvedFieldName, {\n      configurable: true,\n      writable: true,\n      value: null,\n    }) as unknown) as PropertyDescriptor\n  );\n};\n","import { observe } from \"mobx\";\nimport { addHandler } from \"mobx-initializer\";\n\nexport const watch = (watchFieldName: string) => (\n  target: Function,\n  fieldName: string,\n  descriptor: PropertyDescriptor\n) => {\n  if (!descriptor.value) {\n    // eslint-disable-next-line no-console\n    console.error(\"decorator error\", watchFieldName, fieldName, descriptor);\n  }\n  if (fieldName) {\n    const cancelObserveFieldname = Symbol(\n      \"cancelObserveFieldname: \" + fieldName\n    );\n    addHandler(target, \"stateRegister\", function(this: any) {\n      this[cancelObserveFieldname] = observe(\n        this,\n        watchFieldName,\n        descriptor.value.bind(this),\n        true\n      );\n    });\n    addHandler(target, \"release\", function(this: any) {\n      this[cancelObserveFieldname]();\n    });\n  } else {\n    const cancelObserveFieldname = Symbol(\"cancelObserveFieldname\");\n    addHandler(target, \"stateRegister\", function(this: any) {\n      this[cancelObserveFieldname] = observe(\n        watchFieldName,\n        descriptor.value.bind(this)\n      );\n    });\n    addHandler(target, \"release\", function(this: any) {\n      this[cancelObserveFieldname]();\n    });\n  }\n};\n"],"names":["componentAppliedFlag","Symbol","pureComponentAppliedFlag","componentStatus","_component","target","prototype","Component","props","applyHandler","componentDidMount","call","componentWillUnmount","__decorate","observable","ref","_pureComponent","shouldComponentUpdate","nextProps","nextState","state","component","pure","combineClassDecorator","_intercept","handler","fieldName","descriptor","cancelObserveFieldname","toString","addHandler","mobxIntercept","bind","intercept","computed","temporaryFieldName","get","newValue","apply","oldValue","isEqual","fieldIdentifierToFunc","fieldIdentifier","exp","split","map","field","JSON","stringify","join","eval","createPropDecorator","baseDecorator","parametrizePropertyDecorator","propName","getter","_target","prop","deep","delegate","_state","observe","setState","dammy","combinePropertyDecorator","struct","shallow","X","render","fieldId","crypto","value","configurable","Object","defineProperty","defaultHandler","resource","on","off","resourceFieldName","wrappedHandlerFieldName","args","change","resolvedFieldName","writable","watch","watchFieldName","console","error"],"mappings":"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"}