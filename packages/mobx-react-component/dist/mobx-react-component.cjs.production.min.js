"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var tslib=require("tslib"),mobx=require("mobx"),mobxInitializer=require("mobx-initializer"),_=_interopDefault(require("lodash")),crypto=require("crypto");function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var componentAppliedFlag=Symbol("isAppliedMobxReactComponentInitializer"),pureComponentAppliedFlag=Symbol("isAppliedMobxReactPureComponentInitializer"),componentStatus=Symbol("componentStatus"),_component=function(e){var t;if(e.prototype[componentAppliedFlag])return e;var r=function(e){function r(r){var n;return(n=e.call(this,r)||this)[t]=!0,mobxInitializer.applyHandlerOnce(_assertThisInitialized(n),"stateRegister",r),mobxInitializer.applyHandlerOnce(_assertThisInitialized(n),"resourceRegister",r),n}_inheritsLoose(r,e);var n=r.prototype;return n.componentDidMount=function(){var t;null==(t=e.prototype.componentDidMount)||t.call(this),this[componentStatus]="mounted"},n.componentWillUnmount=function(){var t;null==(t=e.prototype.componentWillUnmount)||t.call(this),mobxInitializer.applyHandlerOnce(this,"release")},r}(e);return t=componentAppliedFlag,tslib.__decorate([mobx.observable.ref,tslib.__metadata("design:type",Object)],r.prototype,"props",void 0),r},_pureComponent=function(e){var t,r;return e.prototype[pureComponentAppliedFlag]?e:(r=function(e){function r(){var r;return(r=e.apply(this,arguments)||this)[t]=!0,r}return _inheritsLoose(r,e),r.prototype.shouldComponentUpdate=function(e,t){return t!==this.state},r}(e),t=pureComponentAppliedFlag,r)},component=mobxInitializer.combineDecorator(mobxInitializer.initializer,_component);component.pure=mobxInitializer.combineDecorator(mobxInitializer.initializer,_component,_pureComponent);var _intercept=function(e){return function(t,r,n){console.log("_intercept",n);var o=Symbol("cancelObserveFieldname: "+r);return mobxInitializer.addHandler(t,"stateRegister",(function(t){this[o]=mobx.intercept(this,r,e.bind(this))})),mobxInitializer.addHandler(t,"release",(function(e){this[o]()})),n}},intercept=mobxInitializer.parametrizeDecorator(_intercept,(function(){return null}));intercept.computed=function(e){return function(t,r,n){var o=Symbol("temporaryFieldName: "+r);return mobx.computed(t,r,{get:function(){var t=n.get.apply(this);return e.call(this,{newValue:t,oldValue:this[o]})&&(this[o]=t),this[o]}})}},intercept.isEqual=intercept.computed((function(e){return!_.isEqual(e.newValue,e.oldValue)}));var fieldIdentifierToFunc=function fieldIdentifierToFunc(fieldIdentifier){var exp=fieldIdentifier.split(".").map((function(e){return"(a=a["+JSON.stringify(e)+"])"})).join("&&");return eval("(function(a){return "+exp+";})")},createPropDecorator=function(e){return mobxInitializer.parametrizeDecorator((function(t){return function(r,n,o){var i=fieldIdentifierToFunc(t);return e(r,n,{get:function(){return i(this.props)}})}}),(function(e,t){return t}))},prop=createPropDecorator(mobx.computed);prop.deep=createPropDecorator(intercept.isEqual);var propDelegateDecorator=mobxInitializer.parametrizeDecorator((function(e){return function(t,r,n){return{get:function(){var t=this;return function(){var r;(r=t.props)[e].apply(r,arguments)}}}}}),(function(e,t){return t}));prop.delegate=propDelegateDecorator;var _state=function(e,t,r){var n=Symbol("_observe_"+t);return mobxInitializer.addHandler(e,"stateRegister",(function(e){var r=this;this[n]=mobx.observe(this,t,(function(){var e;"mounted"===r[componentStatus]&&r.setState(((e={})[t]=r[t],e))})),this.state=this.state||{dammy:"###"},this.state[t]=this[t]})),mobxInitializer.addHandler(e,"release",(function(e){this[n]()})),r},state=_state;state.computed=mobxInitializer.combineDecorator(mobx.computed,_state),state.computed.struct=mobxInitializer.combineDecorator(mobx.computed.struct,_state),state.observable=mobxInitializer.combineDecorator(mobx.observable.ref,_state),state.deep=mobxInitializer.combineDecorator(mobx.observable.deep,_state),state.shallow=mobxInitializer.combineDecorator(mobx.observable.shallow,_state),state.ref=mobxInitializer.combineDecorator(mobx.observable.ref,_state),state.struct=mobxInitializer.combineDecorator(mobx.observable.struct,_state);var _render=function(e,t,r){if("render"===t){var n=t+crypto.randomBytes(8).toString("hex");return Object.defineProperty(e,n,state.computed(e,n,r)),{configurable:!0,value:function(){return this[n]}}}return mobxInitializer.addHandler(e,"init",(function(e){this.render=function(){return this[t]}})),state.computed(e,t,r)},render=_render,defaultHandler=function(e){return e},resource=function(e){var t=e.on,r=e.off,n=e.handler,o=void 0===n?defaultHandler:n,i=e.resourceFieldName;return function(e,n,a){var l=Symbol("_"+n+"Handler"),c=Symbol("_resource_"+n);mobxInitializer.addHandler(e,"init",(function(){var e=this;this[l]=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];e[n]=o.apply(e,r)},this[c]=mobx.observe(this,i,(function(n){var o=n.oldValue,i=n.newValue;o&&r(o,e[l]),i&&t(i,e[l])}),!0)})),mobxInitializer.addHandler(e,"release",(function(){this[i]&&r(this[i],this[l]),this[c]()}))}};resource.computed=function(e){var t=e.on,r=e.off,n=e.handler,o=void 0===n?defaultHandler:n;return function(e,n,i){var a=n+"Resource";return Object.defineProperty(e,a,i),mobx.computed(e,a,i),delete e[n],resource({on:t,off:r,handler:o,resourceFieldName:a})(e,n,mobx.observable.ref(e,n,{configurable:!0,writable:!0,value:null}))}};var _watch=function(e){return function(t,r,n){if(n.value||console.error("decorator errsor",e,r,n),r){var o=Symbol("cancelObserveFieldname: "+r);mobxInitializer.addHandler(t,"stateRegister",(function(t){this[o]=mobx.observe(this,e,n.value.bind(this),!0)})),mobxInitializer.addHandler(t,"release",(function(e){this[o]()}))}else{var i=Symbol("cancelObserveFieldname");mobxInitializer.addHandler(t,"stateRegister",(function(t){this[i]=mobx.observe(e,n.value.bind(this))})),mobxInitializer.addHandler(t,"release",(function(e){this[i]()}))}}},watch=mobxInitializer.parametrizeDecorator(_watch,(function(){return null}));exports.component=component,exports.intercept=intercept,exports.prop=prop,exports.render=render,exports.resource=resource,exports.state=state,exports.watch=watch;
//# sourceMappingURL=mobx-react-component.cjs.production.min.js.map
